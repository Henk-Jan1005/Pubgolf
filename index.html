<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PUBGOLF Scoreboard</title>
  <!-- For offline use, download these fonts locally and update the paths accordingly -->
  <link href="local-path-to/roboto.css" rel="stylesheet">
  <link href="local-path-to/material-icons.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: #fafafa;
      color: #333;
    }
    /* Navigation Bar */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      padding: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    nav button {
      background: none;
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    nav button:hover {
      transform: scale(1.1);
    }
    /* Content Area */
    #content {
      padding: 70px 15px 15px; /* leave space for the nav */
      max-width: 800px;
      margin: 0 auto;
    }
    .page {
      display: none;
    }
    h2, h3 {
      text-align: center;
      margin-top: 0;
    }
    /* Team Setup Page */
    .team-card {
      background: #fff;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .team-card input {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .team-card button {
      padding: 6px 10px;
      font-size: 14px;
      border: none;
      background: #2575fc;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .team-card button:hover {
      background: #1a5ecb;
    }
    /* Player Score Cards */
    .player-card {
      background: #fff;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .hole-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 5px 0;
    }
    .btn-adjust {
      font-size: 20px;
      width: 36px;
      height: 36px;
      border: none;
      background: #2575fc;
      color: #fff;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn-adjust:active {
      background: #1a5ecb;
    }
    .score-display {
      width: 40px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }
    .player-total {
      text-align: center;
      font-size: 16px;
      margin-top: 5px;
      font-weight: 500;
    }
    /* Challenge Card */
    .challenge-card {
      background: #fff;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .challenge-card button {
      padding: 8px;
      font-size: 14px;
      border: none;
      background: #28a745;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
      box-sizing: border-box;
    }
    .challenge-card button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav>
    <button onclick="showPage('setupPage')" title="Team Setup">
      <span class="material-icons">group_add</span>
    </button>
    <button onclick="showPage('editScorePage')" title="Edit Scores">
      <span class="material-icons">edit</span>
    </button>
    <button onclick="showPage('scoreGraphPage')" title="Score Graph">
      <span class="material-icons">show_chart</span>
    </button>
    <button onclick="showPage('challengesPage')" title="Challenges">
      <span class="material-icons">emoji_events</span>
    </button>
    <button onclick="clearSavedData()" title="Clear Data">
      <span class="material-icons">delete_forever</span>
    </button>
  </nav>
  
  <!-- Content Area -->
  <div id="content">
    <!-- Setup Teams Page -->
    <div id="setupPage" class="page">
      <div id="setupContent"></div>
    </div>
    
    <!-- Edit Scores Page -->
    <div id="editScorePage" class="page">
      <div id="editScoreContent"></div>
    </div>
    
    <!-- Score Graph Page -->
    <div id="scoreGraphPage" class="page">
      <div id="scoreGraphContent"></div>
    </div>
    
    <!-- Challenges Page -->
    <div id="challengesPage" class="page">
      <div id="challengesContent"></div>
    </div>
  </div>
  
  <!-- Include Chart.js locally for offline use -->
  <script src="local-path-to/chart.js"></script>
  <script>
    // Global Data Structures
    // Teams is an array of objects: { name: string, players: [ { name: string, scores: [9 numbers] } ] }
    let teams = [];
    // Challenges object: keys are challenge names, each with a { completedBy: teamName or null }
    let challenges = {};

    // ---------------------------
    // Teams Persistence
    // ---------------------------
    function saveTeams() {
      localStorage.setItem('pubgolfTeams', JSON.stringify(teams));
    }
    function loadTeams() {
      const data = localStorage.getItem('pubgolfTeams');
      teams = data ? JSON.parse(data) : [];
    }

    // ---------------------------
    // Challenges Persistence
    // ---------------------------
    function saveChallenges() {
      localStorage.setItem('pubgolfChallenges', JSON.stringify(challenges));
    }
    function loadChallenges() {
      const data = localStorage.getItem('pubgolfChallenges');
      if (data) {
        challenges = JSON.parse(data);
        renderChallengesPage();
      } else {
        // Fetch from challenges.txt
        fetch("challenges.txt")
          .then(response => response.text())
          .then(text => {
            const lines = text.split('\n');
            lines.forEach(line => {
              let challenge = line.trim();
              if (challenge) {
                challenges[challenge] = { completedBy: null };
              }
            });
            saveChallenges();
            renderChallengesPage();
          })
          .catch(err => {
            console.error("Error loading challenges.txt:", err);
            challenges = {};
          });
      }
    }
    
    // ---------------------------
    // Navigation
    // ---------------------------
    function showPage(pageId) {
      const pages = document.getElementsByClassName('page');
      for (let page of pages) {
        page.style.display = 'none';
      }
      document.getElementById(pageId).style.display = 'block';
      if (pageId === 'setupPage') {
        renderSetupPage();
      } else if (pageId === 'editScorePage') {
        renderEditScorePage();
      } else if (pageId === 'scoreGraphPage') {
        renderScoreGraphPage();
      } else if (pageId === 'challengesPage') {
        renderChallengesPage();
      }
    }
    
    // ---------------------------
    // Setup Teams Page Functions
    // ---------------------------
    function renderSetupPage() {
      let html = '<h2>Team Setup</h2>';
      if (teams.length === 0) {
        html += '<p>No teams defined. Please add a team below.</p>';
      }
      teams.forEach((team, tIndex) => {
        html += '<div class="team-card">';
        html += 'Team Name: <input type="text" value="' + team.name + '" onchange="updateTeamName(' + tIndex + ', this.value)" />';
        html += '<div style="margin-top:10px;"><strong>Players:</strong></div>';
        team.players.forEach((player, pIndex) => {
          html += '<div class="player-item" style="margin:5px 0;">';
          html += '<input type="text" value="' + player.name + '" onchange="updatePlayerName(' + tIndex + ',' + pIndex + ', this.value)" />';
          html += '</div>';
        });
        html += '<button onclick="addPlayer(' + tIndex + ')">Add Player</button>';
        html += '</div>';
      });
      html += '<button onclick="addTeam()" style="margin-top:10px;">Add Team</button>';
      html += '<br/><button onclick="startGame()" style="margin-top:20px; background:#2575fc; color:#fff; padding:10px; border:none; border-radius:8px;">Start Game</button>';
      document.getElementById('setupContent').innerHTML = html;
    }
    
    function addTeam() {
      teams.push({ name: "New Team", players: [] });
      saveTeams();
      renderSetupPage();
    }
    
    function updateTeamName(tIndex, newName) {
      teams[tIndex].name = newName;
      saveTeams();
      renderSetupPage();
    }
    
    function addPlayer(tIndex) {
      teams[tIndex].players.push({ name: "Player " + (teams[tIndex].players.length + 1), scores: Array(9).fill(0) });
      saveTeams();
      renderSetupPage();
    }
    
    function updatePlayerName(tIndex, pIndex, newName) {
      teams[tIndex].players[pIndex].name = newName;
      saveTeams();
      renderSetupPage();
    }
    
    function startGame() {
      if (teams.length === 0) {
        alert("Please add at least one team.");
        return;
      }
      saveTeams();
      showPage('editScorePage');
      renderEditScorePage();
    }
    
    // ---------------------------
    // Edit Scores Page Functions
    // ---------------------------
    function renderEditScorePage() {
      let html = '<h2>Edit Scores</h2>';
      teams.forEach((team, tIndex) => {
        html += '<div class="team-section" style="border:1px solid #ddd; padding:10px; margin-bottom:20px; border-radius:8px;">';
        html += '<h3>' + team.name + '</h3>';
        team.players.forEach((player, pIndex) => {
          html += '<div class="player-card">';
          html += '<label>Player Name: <input type="text" value="' + player.name + '" onchange="editUpdatePlayerName(' + tIndex + ',' + pIndex + ', this.value)" /></label>';
          for (let i = 0; i < 9; i++) {
            html += '<div class="hole-row">';
            html += '<span>Hole ' + (i + 1) + ':</span>';
            html += '<button class="btn-adjust" onclick="decrementScore(' + tIndex + ',' + pIndex + ',' + i + ')">–</button>';
            html += '<span class="score-display">' + player.scores[i] + '</span>';
            html += '<button class="btn-adjust" onclick="incrementScore(' + tIndex + ',' + pIndex + ',' + i + ')">+</button>';
            html += '</div>';
          }
          let playerTotal = player.scores.reduce((a, b) => a + Number(b), 0);
          html += '<p class="player-total">Player Total: ' + playerTotal + '</p>';
          html += '</div>';
        });
        html += '</div>';
      });
      // Display overall team totals
      html += '<h2>Game Totals</h2>';
      teams.forEach(team => {
        let teamTotal = 0;
        team.players.forEach(player => {
          teamTotal += player.scores.reduce((a, b) => a + Number(b), 0);
        });
        html += '<p><strong>' + team.name + ':</strong> ' + teamTotal + '</p>';
      });
      document.getElementById('editScoreContent').innerHTML = html;
    }
    
    function incrementScore(tIndex, pIndex, holeIndex) {
      teams[tIndex].players[pIndex].scores[holeIndex]++;
      saveTeams();
      renderEditScorePage();
    }
    
    function decrementScore(tIndex, pIndex, holeIndex) {
      teams[tIndex].players[pIndex].scores[holeIndex] = Math.max(0, teams[tIndex].players[pIndex].scores[holeIndex] - 1);
      saveTeams();
      renderEditScorePage();
    }
    
    function editUpdatePlayerName(tIndex, pIndex, newName) {
      teams[tIndex].players[pIndex].name = newName;
      saveTeams();
      renderEditScorePage();
    }
    
    // ---------------------------
    // Score Graph Page Functions
    // ---------------------------
    function renderScoreGraphPage() {
      let html = '<h2>Score Graph</h2>';
      html += '<div class="chart-container" style="margin:0 auto;"><canvas id="scoreChart"></canvas></div>';
      document.getElementById('scoreGraphContent').innerHTML = html;
      updateChart();
    }
    
    function updateChart() {
      const labels = [];
      const data = [];
      teams.forEach(team => {
        let teamTotal = 0;
        team.players.forEach(player => {
          teamTotal += player.scores.reduce((a, b) => a + Number(b), 0);
        });
        labels.push(team.name);
        data.push(teamTotal);
      });
      
      const ctx = document.getElementById('scoreChart').getContext('2d');
      if (window.scoreChartInstance) { window.scoreChartInstance.destroy(); }
      window.scoreChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Team Total Score',
            data: data,
            backgroundColor: 'rgba(37,117,252,0.7)'
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              ticks: { precision: 0 }
            }
          }
        }
      });
    }
    
    // ---------------------------
    // Challenges Page Functions
    // ---------------------------
    function renderChallengesPage() {
      let html = '<h2>Challenges</h2>';
      for (let challenge in challenges) {
        html += '<div class="challenge-card">';
        html += '<p><strong>' + challenge + '</strong></p>';
        if (challenges[challenge].completedBy === null) {
          html += '<button onclick="confirmChallenge(\'' + challenge + '\')">Complete Challenge</button>';
        } else {
          html += '<p class="challenge-completed">Completed by: ' + challenges[challenge].completedBy + '</p>';
        }
        html += '</div>';
      }
      document.getElementById('challengesContent').innerHTML = html;
    }
    
    function confirmChallenge(challengeName) {
      const teamName = prompt("Enter the team name that completed the challenge:", "");
      if (teamName) {
        const exists = teams.some(team => team.name === teamName);
        if (!exists) {
          alert("No team with that name found. Please check team names.");
          return;
        }
        challenges[challengeName].completedBy = teamName;
        saveChallenges();
        alert("Challenge \"" + challengeName + "\" completed by " + teamName + "!");
        renderChallengesPage();
        renderEditScorePage();
      }
    }
    
    // ---------------------------
    // Clear Data Function
    // ---------------------------
    function clearSavedData() {
      if (confirm("Are you sure you want to clear all saved data? This will remove all teams, scores, and challenge completions.")) {
        localStorage.removeItem('pubgolfTeams');
        localStorage.removeItem('pubgolfChallenges');
        alert("Saved data cleared. The page will now reload.");
        location.reload();
      }
    }
    
    // ---------------------------
    // Initialize on Page Load
    // ---------------------------
    window.onload = function() {
      loadTeams();
      loadChallenges();
      // Default to the Setup Page
      showPage('setupPage');
    }
  </script>
</body>
</html>
