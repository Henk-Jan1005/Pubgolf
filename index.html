<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Score Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; font-family: sans-serif; }
    nav {
      display: flex;
      justify-content: space-around;
      background-color: #0077cc;
      color: white;
      padding: 10px 0;
      position: sticky;
      top: 0;
    }
    nav button {
      background: none;
      border: none;
      color: white;
      font-size: 1.1em;
    }
    .tab { display: none; padding: 1em; }
    .tab.active { display: block; }

    input, select, button {
      display: block;
      margin: 10px 0;
      padding: 8px;
      width: 100%;
      font-size: 1em;
    }

    .score-list { margin-top: 1em; }
    .score-list div {
      background: #f4f4f4;
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <nav>
    <button onclick="showTab('edit')">Edit</button>
    <button onclick="showTab('view')">View</button>
  </nav>

  <div id="edit" class="tab active">
    <div id="loginSection">
      <h2>Login</h2>
      <select id="teamSelect">
        <option value="">Select team</option>
        <option value="1">Team 1</option>
        <option value="2">Team 2</option>
        <option value="3">Team 3</option>
      </select>
      <button onclick="login()">Login</button>
    </div>

    <div id="scoreForm" style="display:none;">
      <h2>Edit Scores</h2>
      <p>Logged in as <span id="currentTeam"></span></p>
      <input type="text" id="nameInput" placeholder="Name">
      <input type="number" id="scoreInput" placeholder="Score">
      <button onclick="submitScore()">Submit Score</button>
    </div>
  </div>

  <div id="view" class="tab">
    <h2>All Scores</h2>
    <div id="scores" class="score-list"></div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwayhFDwpUReTh9qUZP4z3Wyk9yuzgn1IgibiQpZgqj1NtbNrsxBddUsxwGZ6Bt-XuO/exec';
    let currentTeam = null;

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    function login() {
      const team = document.getElementById('teamSelect').value;
      if (team) {
        currentTeam = team;
        document.getElementById('currentTeam').textContent = `Team ${team}`;
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('scoreForm').style.display = 'block';
      } else {
        alert("Select a team to login.");
      }
    }

    function submitScore() {
      const name = document.getElementById('nameInput').value;
      const score = document.getElementById('scoreInput').value;

      if (!name || !score) {
        alert("Please fill in both fields.");
        return;
      }

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          action: "submit",
          team: currentTeam,
          name: name,
          score: score
        })
      })
      .then(res => res.text())
      .then(() => {
        alert("Score submitted!");
        document.getElementById('nameInput').value = '';
        document.getElementById('scoreInput').value = '';
        fetchScores();
      });
    }

    function fetchScores() {
      fetch(scriptURL)
        .then(res => res.text())
        .then(text => {
          try {
            const data = JSON.parse(text);
            const scoresDiv = document.getElementById('scores');
            scoresDiv.innerHTML = '';

            data.slice(1).reverse().forEach(row => {
              const div = document.createElement('div');
              div.textContent = `Team ${row[1]} - ${row[2]}: ${row[3]} points`;
              scoresDiv.appendChild(div);
            });
          } catch (err) {
            console.error("Error parsing sheet data", err);
          }
        });
    }

    setInterval(fetchScores, 10000); // auto-update every 10s
    fetchScores(); // load once at start
  </script>
</body>
</html>
